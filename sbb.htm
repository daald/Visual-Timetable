<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>SBB</title>
        <script type="text/javascript" src="jquery-1.8.3.min.js"></script>
        <script type="text/javascript" src="date.format.js"></script>
<script type = "text/javascript">


Date.prototype.setISO8601 = function (string) {
    var regexp = "([0-9]{4})(-([0-9]{2})(-([0-9]{2})" +
        "(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(\.([0-9]+))?)?" +
        "(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?";
    var d = string.match(new RegExp(regexp));

    var offset = 0;
    var date = new Date(d[1], 0, 1);

    if (d[3]) { date.setMonth(d[3] - 1); }
    if (d[5]) { date.setDate(d[5]); }
    if (d[7]) { date.setHours(d[7]); }
    if (d[8]) { date.setMinutes(d[8]); }
    if (d[10]) { date.setSeconds(d[10]); }
    if (d[12]) { date.setMilliseconds(Number("0." + d[12]) * 1000); }
    if (d[14]) {
        offset = (Number(d[16]) * 60) + Number(d[17]);
        offset *= ((d[15] == '-') ? 1 : -1);
    }

    offset -= date.getTimezoneOffset();
    time = (Number(date) + (offset * 60 * 1000));
    this.setTime(Number(time));
}



//            window.onload = function () {
//$(document).ready(function(){
$(function(){

  var R = Raphael("holder", 640, 480);
  R.circle(320, 240, 200).attr({fill: "#000", "fill-opacity": .5, "stroke-width": 5});
  R.circle(450, 240, 200).attr({fill: "#000", "fill-opacity": .5, "stroke-width": 5});



$.ajax({
  type: "GET",
  //url: "http://transport.opendata.ch/v1/stationboard",  data: "station=Aarau&limit=10"
  url: "http://transport.opendata.ch/v1/connections", data: "from=Z%C3%BCrich+Hardbr%C3%BCcke&to=Schaffhausen&date=2012-12-01&time=19:00:00&limit=5"
}).done( function(msg){
  json = JSON.parse(msg);
  console.log(json);

  var h = 480;
  var tMin = 1354389060010;
  var tMax = 1354395120010;
  var tOff = tMin;
  var tScale = h / (tMax-tMin);

  tMin = 5000000000000;
  tMax = 0;

  connections = json.connections;
  console.log('x', connections);
  for ( var cid in connections ) {
    connection = connections[cid];
    console.log( cid + ': ', connection );

    x1 =  parseInt(cid)   *100 + 10;
    x2 = (parseInt(cid)+1)*100 - 10;

    R.rect(x1, 0, x2-x1, h);

    sections = connection.sections
    for ( var sid in sections ) {
      section = sections[sid];

      var date1 = new Date();
      date1.setISO8601( section.departure.departure );
      var y1 = Math.round((date1.getTime() - tOff) * tScale);
      var date2 = new Date();
      date2.setISO8601( section.arrival.arrival );
      var y2 = Math.round((date2.getTime() - tOff) * tScale);

      if (tMin > date1.getTime()) tMin = date1.getTime();
      if (tMax < date2.getTime()) tMax = date2.getTime();

      R.rect(x1+5, y1, x2-x1-10, y2-y1);
      R.text( (x2-x1)/2+x1, y1, date1.format('HH:MM') );//, R.getFont("Museo"), 30).attr({fill: "#fff"});
      R.text( (x2-x1)/2+x1, y2, date2.format('HH:MM') );//, R.getFont("Museo"), 30).attr({fill: "#fff"});

      console.log( '    ' + sid + ': ', section, section.departure, section.arrival );
      console.log( '      ', y1, y2 );

    }
  }

  console.log('tMin', tMin);
  console.log('tMax', tMax);

  //alert( "Data Saved: " + json );

}).fail( function( xmlHttpRequest, statusText, errorThrown ) {
  alert(
    "Your form submission failed.\n\n"
      + "XML Http Request: " + JSON.stringify( xmlHttpRequest )
      + ",\nStatus Text: " + statusText
      + ",\nError Thrown: " + errorThrown );
});

});


 /*   // Define the entry point
    $(function() {
    {
  alert('abc');
    });*/
</script>

        <script src="http://raphaeljs.com/raphael.js"></script>
        <scriptx>


	    $(document).ready(function() {
            //window.onload = function () {
                var src = document.getElementById("bee").src,
                    angle = 0;
                document.getElementById("holder").innerHTML = "";
                var R = Raphael("holder", 640, 480);
                R.circle(320, 240, 200).attr({fill: "#000", "fill-opacity": .5, "stroke-width": 5});
                var img = R.image(src, 160, 120, 320, 240);
                var butt1 = R.set(),
                    butt2 = R.set();
                butt1.push(R.circle(24.833, 26.917, 26.667).attr({stroke: "#ccc", fill: "#fff", "fill-opacity": .4, "stroke-width": 2}),
                           R.path("M12.582,9.551C3.251,16.237,0.921,29.021,7.08,38.564l-2.36,1.689l4.893,2.262l4.893,2.262l-0.568-5.36l-0.567-5.359l-2.365,1.694c-4.657-7.375-2.83-17.185,4.352-22.33c7.451-5.338,17.817-3.625,23.156,3.824c5.337,7.449,3.625,17.813-3.821,23.152l2.857,3.988c9.617-6.893,11.827-20.277,4.935-29.896C35.591,4.87,22.204,2.658,12.582,9.551z").attr({stroke: "none", fill: "#000"}),
                           R.circle(24.833, 26.917, 26.667).attr({fill: "#fff", opacity: 0}));
                butt2.push(R.circle(24.833, 26.917, 26.667).attr({stroke: "#ccc", fill: "#fff", "fill-opacity": .4, "stroke-width": 2}),
                           R.path("M37.566,9.551c9.331,6.686,11.661,19.471,5.502,29.014l2.36,1.689l-4.893,2.262l-4.893,2.262l0.568-5.36l0.567-5.359l2.365,1.694c4.657-7.375,2.83-17.185-4.352-22.33c-7.451-5.338-17.817-3.625-23.156,3.824C6.3,24.695,8.012,35.06,15.458,40.398l-2.857,3.988C2.983,37.494,0.773,24.109,7.666,14.49C14.558,4.87,27.944,2.658,37.566,9.551z").attr({stroke: "none", fill: "#000"}),
                           R.circle(24.833, 26.917, 26.667).attr({fill: "#fff", opacity: 0}));
                butt1.translate(10, 181);
                butt2.translate(10, 245);
                butt1[2].click(function () {
                    angle -= 90;
                    img.stop().animate({transform: "r" + angle}, 1000, "<>");
                }).mouseover(function () {
                    butt1[1].animate({fill: "#fc0"}, 300);
                }).mouseout(function () {
                    butt1[1].stop().attr({fill: "#000"});
                });
                butt2[2].click(function () {
                    angle += 90;
                    img.animate({transform: "r" + angle}, 1000, "<>");
                }).mouseover(function () {
                    butt2[1].animate({fill: "#fc0"}, 300);
                }).mouseout(function () {
                    butt2[1].stop().attr({fill: "#000"});
                });
                // setTimeout(function () {R.safari();});
            });
        </script>
    </head>
    <body>
        <div id="holder">
            <img id="bee" src="http://raphaeljs.com/bd.jpg" width="320" height="240" alt="Bee">
        </div>
        <p id="copy">Demo of <a href="http://raphaeljs.com/">Raphaël</a>—JavaScript Vector Library</p>
    </body>
</html>

